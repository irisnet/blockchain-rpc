<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Test Blockchain-RPC Server</title>
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <style type="text/css">
        div.title p {
            font-weight: bolder;
            font-size: larger;
            background-color: floralwhite;
            color: black;
        }
        div.title {
            margin-top: 3%;
            margin-bottom: 3%;
        }
        div.res {
            margin-top: 3%;
        }
        div.res p {
            font-weight: 700;
            color: green;
        }
    </style>
</head>
<body>

<div class="container-fluid">

    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li role="presentation" class="active"><a href="#getSequence" aria-controls="getSequence" role="tab" data-toggle="tab">获取 Sequence</a>
        </li>
        <li role="presentation"><a href="#buildTx" aria-controls="buildTx" role="tab" data-toggle="tab">构造交易</a></li>
        <li role="presentation"><a href="#postTx" aria-controls="postTx" role="tab" data-toggle="tab">提交交易</a></li>
        <li role="presentation"><a href="#getBalance" aria-controls="getBalance" role="tab"
                                   data-toggle="tab">获取余额</a></li>
        <li role="presentation"><a href="#getTxList" aria-controls="getTxList" role="tab"
                                   data-toggle="tab">交易列表</a></li>
        <li role="presentation"><a href="#getTxDetail" aria-controls="getTxDetail" role="tab" data-toggle="tab">交易详情</a>
        </li>
    </ul>

    <div class="tab-content">
        <div id="getSequence" role="tabpanel" class="row col-md-8 col-md-offset-2 tab-pane active">
            <div class="title">
                <p class="bg-primary">获取 Sequence</p>
            </div>

            <div class="req">
                <form class="form">
                    <div class="form-group">
                        <label for="sequenceReqAddress">Address</label>
                        <input type="text" class="form-control" id="sequenceReqAddress" placeholder="请输入账户地址">
                    </div>
                    <button type="button" class="btn btn-default">Submit</button>
                </form>
            </div>

            <div class="res">
                <p>Result:</p>
                <pre></pre>
            </div>
        </div>

        <div id="buildTx" role="tabpanel" class="row col-md-8 col-md-offset-2 tab-pane">
            <div class="title">
                <p class="bg-primary">构造交易</p>
            </div>

            <div class="req">
                <form class="form">
                    <div class="form-group">
                        <label for="buildTxReqSequence">Sequence</label>
                        <input type="number" class="form-control" id="buildTxReqSequence">
                    </div>
                    <div class="form-group">
                        <label for="buildTxReqSender">Sender Address</label>
                        <input type="text" class="form-control" id="buildTxReqSender"
                               value="BED890EB9DB1309E0884DF8BDD41B16461D8E194">
                    </div>
                    <div class="form-group">
                        <label for="buildTxReqReceiver">Receiver Address</label>
                        <input type="text" class="form-control" id="buildTxReqReceiver"
                               value="00F1709556F1899B40FFD5B138C9D6C3B82BB476">
                    </div>
                    <div class="form-group">
                        <label for="buildTxReqCoinDenom">Coin Denom</label>
                        <input type="text" class="form-control" id="buildTxReqCoinDenom" value="iris"
                               placeholder="iris">
                    </div>
                    <div class="form-group">
                        <label for="buildTxReqCoinAmount">Coin Amount</label>
                        <input type="number" class="form-control" id="buildTxReqCoinAmount">
                    </div>
                    <div class="form-group">
                        <label for="buildTxReqFeeDenom">Fee Denom</label>
                        <input type="text" class="form-control" id="buildTxReqFeeDenom" value="fermion">
                    </div>
                    <div class="form-group">
                        <label for="buildTxReqFeeAmount">Fee Amount</label>
                        <input type="number" class="form-control" id="buildTxReqFeeAmount" value="0">
                    </div>
                    <div class="form-group">
                        <label for="buildTxReqMemoId">Memo Id</label>
                        <input type="number" class="form-control" id="buildTxReqMemoId" value="0">
                    </div>
                    <div class="form-group">
                        <label for="buildTxReqMemoText">Memo text</label>
                        <input type="text" class="form-control" id="buildTxReqMemoText">
                    </div>
                    <div class="form-group">
                        <label for="buildTxReqTxType">TxType</label>
                        <select id="buildTxReqTxType" style="display: block">
                            <option value="coin">转账</option>
                            <option value="delegate">委托</option>
                            <option value="unbond">取回</option>
                        </select>
                    </div>
                    <button type="button" class="btn btn-default">Submit</button>
                </form>
            </div>

            <div class="res">
                <p>Result:</p>
                <pre></pre>
            </div>
        </div>

        <div id="postTx" role="tabpanel" class="row col-md-8 col-md-offset-2 tab-pane">
            <div class="title">
                <p class="bg-primary">提交交易</p>
            </div>

            <div class="req">
                <form class="form">
                    <div class="form-group">
                        <label for="postTxReqTx">Tx</label>
                        <input type="text" class="form-control" id="postTxReqTx">
                    </div>
                    <button type="button" class="btn btn-default">Submit</button>
                </form>
            </div>

            <div class="res">
                <p>Result:</p>
                <pre></pre>
            </div>
        </div>

        <div id="getBalance" role="tabpanel" class="row col-md-8 col-md-offset-2 tab-pane">
            <div class="title">
                <p class="bg-primary">获取账户余额</p>
            </div>

            <div class="req">
                <form class="form">
                    <div class="form-group">
                        <label for="balanceReqAddress">Address</label>
                        <input type="text" class="form-control" id="balanceReqAddress">
                    </div>
                    <button type="button" class="btn btn-default">Submit</button>
                </form>
            </div>

            <div class="res">
                <p>Result:</p>
                <pre></pre>
            </div>
        </div>

        <div id="getTxList" role="tabpanel" class="row col-md-8 col-md-offset-2 tab-pane">
            <div class="title">
                <p class="bg-primary">交易列表</p>
            </div>

            <div class="req">
                <form class="form">
                    <div class="form-group">
                        <label for="txListReqAddr">Address</label>
                        <input type="text" class="form-control" id="txListReqAddr">
                    </div>
                    <div class="form-group">
                        <label for="txListReqPage">Page</label>
                        <input type="number" class="form-control" id="txListReqPage" value="1">
                    </div>
                    <div class="form-group">
                        <label for="txListReqPerPage">PerPage</label>
                        <input type="number" class="form-control" id="txListReqPerPage" value="10">
                    </div>
                    <div class="form-group">
                        <label for="txListReqStatus">Tx status</label>
                        <input type="text" class="form-control" disabled id="txListReqStatus">
                    </div>
                    <div class="form-group">
                        <label for="txListReqType">Tx Type</label>
                        <select id="txListReqType" style="display: block">
                            <option value="">全部</option>
                            <option value="send">付款</option>
                            <option value="receive">收款</option>
                            <option value="delegate">委托</option>
                            <option value="unbond">取回</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="txListReqStartTime">StartTime</label>
                        <input type="text" class="form-control" id="txListReqStartTime"
                               placeholder="formatter: 2018-06-20 11:41:00">
                    </div>
                    <div class="form-group">
                        <label for="txListReqEndTime">EndTime</label>
                        <input type="text" class="form-control" id="txListReqEndTime"
                               placeholder="formatter: 2018-06-21 00:00:00">
                    </div>
                    <div class="form-group">
                        <label for="txListReqSort">Sort</label>
                        <input type="text" class="form-control" id="txListReqSort" placeholder="-time">
                    </div>
                    <div class="form-group">
                        <label for="txListReqQ">Query</label>
                        <input type="text" class="form-control" id="txListReqQ">
                    </div>
                    <button type="button" class="btn btn-default">Submit</button>
                </form>
            </div>

            <div class="res">
                <p>Result:</p>
                <pre></pre>
            </div>
        </div>

        <div id="getTxDetail" role="tabpanel" class="row col-md-8 col-md-offset-2 tab-pane">
            <div class="title">
                <p class="bg-primary">交易详情</p>
            </div>

            <div class="req">
                <form class="form">
                    <div class="form-group">
                        <label for="txDetailReqTxHash">TxHash</label>
                        <input type="text" class="form-control" id="txDetailReqTxHash">
                    </div>
                    <button type="button" class="btn btn-default">Submit</button>
                </form>
            </div>

            <div class="res">
                <p>Result:</p>
                <pre></pre>
            </div>
        </div>

    </div>


</div>

<script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
<script src="../codegen/gen-js/thrift.js"></script>
<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"
        integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
        crossorigin="anonymous"></script>

<script src="../codegen/gen-js/model_common_types.js"></script>

<script src="../codegen/gen-js/model_sequence_types.js"></script>
<script src="../codegen/gen-js/model_buildTx_types.js"></script>
<script src="../codegen/gen-js/model_postTx_types.js"></script>

<script src="../codegen/gen-js/model_balance_types.js"></script>
<script src="../codegen/gen-js/model_txList_types.js"></script>
<script src="../codegen/gen-js/model_txDetail_types.js"></script>

<script src="../codegen/gen-js/BlockChainService.js"></script>

<script>
    transport = new Thrift.TXHRTransport("http://192.168.150.162:9080/blockchain");
    protocol = new Thrift.Protocol(transport);
    client = new BlockChainServiceClient(protocol);

    // getSequence
    $("#getSequence button").click(function () {
        var res;
        var domRes = $(this).parents("div#getSequence").find("div.res > pre");

        var address = $("#sequenceReqAddress").val();
        var req = new SequenceRequest();
        req.address = address;

        try {
            res = client.GetSequence(req);
        } catch (e) {
            res = e.message
        }
        domRes.text(JSON.stringify(res, null, 2));
    });

    // buildTx
    $("#buildTx button").click(function () {
        var res;
        var domRes = $(this).parents("div#buildTx").find("div.res > pre");

        var req = new BuildTxRequest();
        req.sequence = $("#buildTxReqSequence").val();

        sender = new Address();
        sender.chain = "";
        sender.app = "sigs";
        sender.addr = $("#buildTxReqSender").val();

        req.sender = sender;

        receiver = new Address();
        receiver.chain = "";
        receiver.app = "sigs";
        receiver.addr = $("#buildTxReqReceiver").val();

        req.receiver = receiver;

        coin = new Coin();
        coin.denom = $("#buildTxReqCoinDenom").val();
        coin.amount = $("#buildTxReqCoinAmount").val();
        coins = new Array(coin);
        req.amount = coins;

        fee = new Fee();
        fee.denom = $("#buildTxReqFeeDenom").val();
        fee.amount = $("#buildTxReqFeeAmount").val();
        req.fee = fee;

        memo = new Memo();
        memo.id = $("#buildTxReqMemoId").val();
        memo.text = $("#buildTxReqMemoText").val();
        req.memo = memo;

        req.txType = $("#buildTxReqTxType").val();

        console.log(req);

        try {
            res = client.BuildTx(req)
        } catch (e) {
            res = e.message
        }
        domRes.text(JSON.stringify(res, null, 2));
    });

    // postTx
    $("#postTx button").click(function () {
        var res;
        var domRes = $(this).parents("div#postTx").find("div.res > pre");

        var tx = $("#postTxReqTx").val();
        var req = new PostTxRequest();
        req.tx = tx;

        try {
            res = client.PostTx(req);
        } catch (e) {
            res = e.message
        }
        domRes.text(JSON.stringify(res, null, 2));
    });

    // getBalance
    $("#getBalance button").click(function () {
        var res;
        var domRes = $(this).parents("div#getBalance").find("div.res > pre");

        var address = $("#balanceReqAddress").val();
        var req = new BalanceRequest();
        req.address = address;

        try {
            res = client.GetBalance(req);
        } catch (e) {
            res = e.message
        }
        domRes.text(JSON.stringify(res, null, 2));
    });

    // getTxList
    $("#getTxList button").click(function () {
        var res;
        var domRes = $(this).parents("div#getTxList").find("div.res > pre");

        var req = new TxListRequest();
        req.address = $("#txListReqAddr").val();
        req.page = $("#txListReqPage").val();
        req.perPage = $("#txListReqPerPage").val();
        req.type = $("#txListReqType").val();
        req.startTime = $("#txListReqStartTime").val();
        req.endTime = $("#txListReqEndTime").val();
        req.sort = $("#txListReqSort").val();
        req.q = $("#txListReqQ").val();


        try {
            res = client.GetTxList(req);
        } catch (e) {
            res = e.message
        }
        domRes.text(JSON.stringify(res, null, 2));
    });

    // getTxDetail
    $("#getTxDetail button").click(function () {
        var res;
        var domRes = $(this).parents("div#getTxDetail").find("div.res > pre");

        var req = new TxDetailRequest();
        req.txHash = $("#txDetailReqTxHash").val();

        try {
            res = client.GetTxDetail(req);
        } catch (e) {
            res = e.message
        }
        domRes.text(JSON.stringify(res, null, 2));
    });
</script>
</body>
</html>